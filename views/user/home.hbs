<div class="container pt-4" id="homeContainer">

  <!-- SEARCH BAR -->
  <div id="searchWrapper" class="mb-4 position-relative">
    <div class="input-group input-group-lg shadow-sm" style="border-radius: 15px; overflow: hidden;">
      <span class="input-group-text bg-white border-0">
        <i class="bi bi-search text-muted"></i>
      </span>
      <input id="searchInput" type="text" class="form-control border-0 shadow-none"
             placeholder="Search plants, categories, or products..." 
             style="padding-left: 0;">
      <button id="clearSearchBtn" class="btn btn-outline-secondary border-0"
              style="display: none;">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>

  <!-- HORIZONTAL CATEGORY BAR -->
  <div id="categoryWrapper" class="mb-4">
    <div class="d-flex align-items-center justify-content-between">
      <h5 class="mb-0 me-3 text-muted" style="font-size: 0.9rem;"></h5>
      <div class="d-flex flex-row gap-4 overflow-auto pb-3 flex-grow-1 scroll-container">
        <!-- Categories with icons -->
        <span class="badge category-filter active-cat" data-category="all">
          <i class="bi bi-grid-fill me-1"></i>All
        </span>

        <span class="badge category-filter" data-category="indoor plant">
          <i class="bi bi-house-door-fill me-1"></i>Indoor Plants
        </span>

        <span class="badge category-filter" data-category="outdoor plant">
          <i class="bi bi-tree-fill me-1"></i>  Outdoor Plants
        </span>

        <span class="badge category-filter" data-category="succulent">
          <i class="bi bi-droplet-fill me-1"></i>Succulents 
        </span>

        <span class="badge category-filter" data-category="herb">
          <i class="bi bi-flower1 me-1"></i>Herbs
        </span>

        <span class="badge category-filter" data-category="flowering plant">
          <i class="bi bi-flower2 me-1"></i>Flowering Plants
        </span>

        <span class="badge category-filter" data-category="Aquatic Plant">
          <i class="bi bi-water me-1"></i>Aquatic Plants
        </span>

        <span class="badge category-filter" data-category="accessories and tools">
          <i class="bi bi-tools me-1"></i>Accessories &Tools
        </span>
      </div>

      <!-- Clear Category Button -->
      <button id="clearCategoryBtn" class="btn btn-sm btn-outline-danger ms-2 d-none" 
              style="border-radius: 20px;">
        <i class="bi bi-x-circle me-1"></i>Clear
      </button>
    </div>
  </div>

  <!-- BANNER -->
  <div id="bannerWrapper" class="mb-4 banner-container">
    <img src="/images/banner.png" alt="Shalom Garden - Beautiful Plants" 
         class="img-fluid shadow-sm banner-image">
  </div>

  <!-- PRODUCT GRID -->
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="mb-0 section-title">ðŸŒ± Explore Our Collection</h2>
    <small class="text-muted product-count" id="productCount"></small>
  </div>
 <!-- ðŸ”½ Price Filter Dropdown -->
    <div class="dropdown mb-2">
      <button class="btn btn-outline-success btn-sm dropdown-toggle" type="button" id="priceFilterBtn" data-bs-toggle="dropdown" aria-expanded="false" style="border-radius:8px;">
        ðŸ’° Price Filter
      </button>
      <ul class="dropdown-menu dropdown-menu-end p-2 shadow-sm" aria-labelledby="priceFilterBtn" style="min-width:200px;">
        <li><a class="dropdown-item price-filter" data-min="0" data-max="50">Below â‚¹50</a></li>
        <li><a class="dropdown-item price-filter" data-min="50" data-max="100">â‚¹50 - â‚¹100</a></li>
        <li><a class="dropdown-item price-filter" data-min="100" data-max="200">â‚¹100 - â‚¹200</a></li>
        <li><a class="dropdown-item price-filter" data-min="200" data-max="500">â‚¹200 - â‚¹500</a></li>
        <li><a class="dropdown-item price-filter" data-min="500" data-max="1000">â‚¹500 - â‚¹1000</a></li>
        <li><a class="dropdown-item price-filter" data-min="1000" data-max="999999">Above â‚¹1000</a></li>
        <li><hr class="dropdown-divider"></li>
        <li class="px-2">
          <input type="number" id="customPrice" class="form-control form-control-sm" placeholder="Custom max â‚¹" min="1" style="font-size:0.85rem;">
        </li>
        <li class="px-2 pt-2">
          <button id="applyCustomPrice" class="btn btn-success btn-sm w-100">Apply</button>
        </li>
      </ul>
    </div>
  </div>
</div>
  {{#if products.length}}
  <div class="row g-4" id="productsContainer">
    {{#each products}}
    <div class="col-6 col-sm-4 col-md-3 col-lg-2 product-card" data-category="{{this.category}}">
      <div class="card product-card-inner shadow-sm h-100">
        <div class="card-image-container">
          <img src="{{this.image}}" class="card-img-top product-image" 
               alt="{{this.name}}"
               onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='">
          
          
          <!-- Rating Badge -->
          {{#if this.averageRating}}
          <div class="rating-badge">
            <i class="bi bi-star-fill"></i> {{this.averageRating}}
            <small class="text-muted">({{this.totalReviews}})</small>
          </div>
          {{/if}}
        </div>
        
        <div class="card-body d-flex flex-column">
          <h6 class="card-title product-name">{{this.name}}</h6>
          <p class="card-text text-muted product-category">
            {{this.category}}
          </p>
          
          <!-- Rating Stars (Visual) -->
          <div class="rating-stars mb-2">
            {{#times 5}}
              {{#if (gte ../this.averageRating (add this 1))}}
                <i class="bi bi-star-fill text-warning"></i>
              {{else if (gte ../this.averageRating (add this 0.5))}}
                <i class="bi bi-star-half text-warning"></i>
              {{else}}
                <i class="bi bi-star text-warning"></i>
              {{/if}}
            {{/times}}
          </div>
          
          <div class="mt-auto">
            <p class="product-price mb-2">â‚¹{{this.price}}</p>
            <a href="/view-product/{{this._id}}" class="btn btn-success w-100 add-to-cart-btn">
              <i class="bi bi-cart-plus me-1"></i> Buy Now
            </a>
          </div>
        </div>
      </div>
    </div>
    {{/each}}
  </div>

  <div id="noResults" class="text-center mt-5 d-none">
    <div class="no-results-icon">
      <i class="bi bi-search display-1 text-muted"></i>
    </div>
    <h4 class="text-muted mt-3">No products found</h4>
    <p class="text-muted">Try adjusting your search or filter criteria</p>
    <button id="resetFilters" class="btn btn-outline-success mt-2">
      <i class="bi bi-arrow-clockwise me-1"></i>Reset Filters
    </button>
  </div>

  {{else}}
  <div class="text-center py-5">
    <i class="bi bi-inbox display-1 text-muted"></i>
    <h4 class="text-muted mt-3">No products available</h4>
    <p class="text-muted">Check back later for new arrivals</p>
  </div>
  {{/if}}
</div>

<!-- Enhanced JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // DOM Elements
  const searchInput = document.getElementById("searchInput");
  const clearSearchBtn = document.getElementById("clearSearchBtn");
  const categoryFilters = Array.from(document.querySelectorAll(".category-filter"));
  const productCards = Array.from(document.querySelectorAll(".product-card"));
  const noResults = document.getElementById("noResults");
  const clearCategoryBtn = document.getElementById("clearCategoryBtn");
  const bannerWrapper = document.getElementById("bannerWrapper");
  const resetFilters = document.getElementById("resetFilters");
  const productCount = document.getElementById("productCount");

  // Utility Functions
  const normalize = str => (str || "").toString().trim().toLowerCase().replace(/\s+/g, ' ');
  
  // Initialize product count
  function updateProductCount(visible, total) {
    if (productCount) {
      productCount.textContent = `${visible} of ${total} products`;
    }
  }

  // Ensure there's always an active badge
  function ensureActiveBadge() {
    if (!document.querySelector(".category-filter.active-cat")) {
      const first = categoryFilters[0];
      if (first) {
        first.classList.add("active-cat");
      }
    }
  }

  function getActiveCategory() {
    const el = document.querySelector(".category-filter.active-cat");
    return el ? normalize(el.dataset.category || "all") : "all";
  }

  function setActiveBadge(el) {
    categoryFilters.forEach(b => {
      b.classList.remove("active-cat");
    });
    if (el) {
      el.classList.add("active-cat");
    }
  }

  function updateClearButtons(hasActiveFilter) {
    clearCategoryBtn.classList.toggle("d-none", !hasActiveFilter);
  }

  // Enhanced filtering with animations
  function filterProducts() {
    const q = normalize(searchInput.value);
    const activeCategory = getActiveCategory();

    let visibleCount = 0;
    const totalProducts = productCards.length;

    productCards.forEach((card, index) => {
      const name = normalize(card.querySelector(".product-name")?.textContent || "");
      const description = normalize(card.querySelector(".product-description")?.textContent || "");
      const cardCategoryRaw = card.dataset.category || "";
      const cardCategory = normalize(cardCategoryRaw);

      // Robust category matching
      const matchesCategory = activeCategory === "all" ||
                              cardCategory.includes(activeCategory) ||
                              activeCategory.includes(cardCategory);

      // Enhanced search matching (name, description, category)
      const matchesSearch = !q || 
                           name.includes(q) || 
                           description.includes(q) ||
                           cardCategory.includes(q);

      if (matchesCategory && matchesSearch) {
        // Show with staggered animation
        setTimeout(() => {
          card.style.display = '';
          card.classList.remove('d-none');
          card.classList.add('fade-in');
        }, index * 50);
        visibleCount++;
      } else {
        card.classList.add('d-none');
        card.classList.remove('fade-in');
      }
    });

    // Update banner visibility
    const anyFilterActive = (q !== "" || activeCategory !== "all");
    bannerWrapper.style.display = anyFilterActive ? "none" : "";

    // Update UI states
    noResults.classList.toggle("d-none", visibleCount > 0);
    clearSearchBtn.style.display = q ? "" : "none";
    updateClearButtons(activeCategory !== "all");
    updateProductCount(visibleCount, totalProducts);

    // Add shake animation to no results if needed
    if (visibleCount === 0 && (q || activeCategory !== 'all')) {
      noResults.classList.add('shake-animation');
      setTimeout(() => noResults.classList.remove('shake-animation'), 500);
    }
  }

  // Event Listeners
  searchInput.addEventListener("input", () => {
    filterProducts();
  });

  clearSearchBtn.addEventListener("click", () => {
    searchInput.value = "";
    clearSearchBtn.style.display = "none";
    filterProducts();
    searchInput.focus();
  });

  categoryFilters.forEach(btn => {
    btn.addEventListener("click", () => {
      if (btn.classList.contains("active-cat")) {
        setActiveBadge(categoryFilters[0]);
      } else {
        setActiveBadge(btn);
      }
      filterProducts();
    });
  });

  clearCategoryBtn.addEventListener("click", () => {
    setActiveBadge(categoryFilters[0]);
    filterProducts();
  });

  if (resetFilters) {
    resetFilters.addEventListener("click", () => {
      searchInput.value = "";
      setActiveBadge(categoryFilters[0]);
      filterProducts();
      searchInput.focus();
    });
  }

  // Keyboard shortcuts
  searchInput.addEventListener("keydown", (e) => {
    if (e.key === 'Escape') {
      searchInput.value = "";
      filterProducts();
    }
  });

  // Initialize
  ensureActiveBadge();
  filterProducts();
});
// Price Filter Logic
const priceFilterButtons = document.querySelectorAll('.price-filter');
const customPriceInput = document.getElementById('customPrice');
const applyCustomPriceBtn = document.getElementById('applyCustomPrice');

let priceRange = { min: 0, max: Infinity };

// Function to filter by price (used along with your search/category filters)
function filterByPrice() {
  const products = document.querySelectorAll('.product-card');
  let visibleCount = 0;

  products.forEach(card => {
    const priceText = card.querySelector('.product-price')?.textContent.replace(/[â‚¹,]/g, '').trim();
    const price = parseFloat(priceText) || 0;

    const matchesPrice = price >= priceRange.min && price <= priceRange.max;
    if (matchesPrice) {
      card.style.display = '';
      card.classList.remove('d-none');
      visibleCount++;
    } else {
      card.style.display = 'none';
      card.classList.add('d-none');
    }
  });

  // Update product count
  const totalProducts = products.length;
  document.getElementById('productCount').textContent = `${visibleCount} of ${totalProducts} products`;
}

// Attach listeners to price range items
priceFilterButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const min = parseFloat(btn.dataset.min);
    const max = parseFloat(btn.dataset.max);
    priceRange = { min, max };
    filterByPrice();

    // Visual feedback
    priceFilterButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  });
});

// Custom Price Apply
applyCustomPriceBtn.addEventListener('click', () => {
  const customMax = parseFloat(customPriceInput.value);
  if (!isNaN(customMax) && customMax > 0) {
    priceRange = { min: 0, max: customMax };
    filterByPrice();
  } else {
    alert("Please enter a valid price.");
  }
});

</script>

<style>
/* Reset and Base Styles */
#homeContainer * {
  box-sizing: border-box;
}

/* Custom Animations */
@keyframes fadeIn {
  from { 
    opacity: 0; 
    transform: translateY(20px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Component Styles */
.fade-in {
  animation: fadeIn 0.5s ease-out;
}

.shake-animation {
  animation: shake 0.5s ease-in-out;
}

/* Search Bar */
#searchWrapper .input-group {
  border-radius: 15px;
  transition: all 0.3s ease;
  border: 1px solid #dee2e6;
}

#searchWrapper .input-group:focus-within {
  box-shadow: 0 4px 15px rgba(45, 90, 39, 0.2) !important;
  transform: translateY(-2px);
  border-color: #2d5a27;
}

/* Category Bar */
.scroll-container {
  scrollbar-width: thin;
  scrollbar-color: #2d5a27 #f1f1f1;
  min-height: 50px;
  align-items: center;
}

.scroll-container::-webkit-scrollbar {
  height: 6px;
}

.scroll-container::-webkit-scrollbar-thumb {
  background: #2d5a27;
  border-radius: 3px;
}

.badge.category-filter {
  cursor: pointer;
  user-select: none;
  border: 2px solid #e9ecef;
  background: white;
  color: #6c757d;
  font-weight: 500;
  padding: 8px 16px;
  border-radius: 25px;
  white-space: nowrap;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 0.85rem;
  flex-shrink: 0;
}

.badge.category-filter:hover {
  border-color: #2d5a27;
  color: #2d5a27;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(45, 90, 39, 0.15);
}

.badge.category-filter.active-cat {
  background: linear-gradient(135deg, #2d5a27, #3a7c32) !important;
  color: white !important;
  border-color: #2d5a27;
  box-shadow: 0 4px 15px rgba(45, 90, 39, 0.3);
}

/* Banner */
.banner-container {
  position: relative;
  overflow: hidden;
  border-radius: 20px;
}

.banner-image {
  width: 100%;
  height: 220px;
  object-fit: cover;
  transition: transform 0.5s ease;
  border-radius: 20px;
}

.banner-container:hover .banner-image {
  transform: scale(1.02);
}

/* Product Cards - Fixed Layout */
#productsContainer {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

@media (min-width: 576px) {
  #productsContainer {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 768px) {
  #productsContainer {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (min-width: 992px) {
  #productsContainer {
    grid-template-columns: repeat(5, 1fr);
  }
}

@media (min-width: 1200px) {
  #productsContainer {
    grid-template-columns: repeat(6, 1fr);
  }
}

.product-card {
  display: block;
  width: 100%;
}

.product-card-inner {
  border: none;
  border-radius: 16px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.product-card-inner:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15) !important;
}

.card-image-container {
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
}

.product-image {
  height: 180px;
  width: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
  display: block;
}

.product-card-inner:hover .product-image {
  transform: scale(1.1);
}

.category-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(255, 255, 255, 0.95);
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 600;
  color: #2d5a27;
  backdrop-filter: blur(10px);
  z-index: 2;
}

.card-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 1rem;
}

.product-name {
  color: #2d5a27;
  font-weight: 700;
  font-size: 0.9rem;
  line-height: 1.3;
  margin-bottom: 1px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  min-height: 2.6rem;
}

.product-category {
  font-size: 0.75rem;
  line-height: 1.3;
  
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  margin-bottom: 1px;
  color: #6c757d;
  min-height: 2rem;
}

.product-price {
  font-weight: 700;
  color: #2d5a27;
  font-size: 1rem;
  margin-bottom: 0.5rem;
}

.add-to-cart-btn {
  border: none;
  border-radius: 12px;
  padding: 8px 12px;
  font-weight: 600;
  font-size: 0.85rem;
  background: linear-gradient(135deg, #28a745, #20c997);
  transition: all 0.3s ease;
  color: white;
  text-decoration: none;
  text-align: center;
  display: block;
}

.add-to-cart-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
  background: linear-gradient(135deg, #218838, #1e9e8a);
  color: white;
}

/* Rating Styles */
.rating-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255, 255, 255, 0.95);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  color: #ffc107;
  backdrop-filter: blur(10px);
  border: 1px solid #ffeaa7;
  z-index: 2;
}

.rating-stars {
  font-size: 0.8rem;
  line-height: 1;
  margin-bottom: 0.5rem;
  min-height: 1rem;
}

.rating-stars .bi-star-fill,
.rating-stars .bi-star-half,
.rating-stars .bi-star {
  margin-right: 1px;
  display: inline-block;
}

/* Section Title */
.section-title {
  color: #2d5a27;
  font-weight: 800;
  position: relative;
  padding-bottom: 0.5rem;
  font-size: 1.5rem;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 50px;
  height: 3px;
  background: linear-gradient(90deg, #2d5a27, #28a745);
  border-radius: 2px;
}

/* No Results */
.no-results-icon {
  opacity: 0.7;
  transition: opacity 0.3s ease;
}

#noResults:hover .no-results-icon {
  opacity: 1;
  animation: pulse 1s ease-in-out;
}

/* Product count */
.product-count {
  font-size: 0.8rem;
  font-weight: 500;
}

/* Responsive Design */
@media (max-width: 768px) {
  .scroll-container {
    gap: 0.5rem !important;
  }
  
  .badge.category-filter {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .product-card-inner:hover {
    transform: translateY(-4px);
  }
  
  .section-title {
    font-size: 1.3rem;
  }
  
  .product-image {
    height: 150px;
  }
}

@media (max-width: 576px) {
  .banner-image {
    height: 160px;
  }
  
  .product-image {
    height: 140px;
  }
  
  #searchWrapper .input-group-lg {
    font-size: 0.9rem;
  }
  
  #productsContainer {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }
  
  .card-body {
    padding: 0.75rem;
    
  }
  
  .product-name {
    font-size: 0.85rem;
  }
  
  .add-to-cart-btn {
    font-size: 0.8rem;
    padding: 6px 10px;
  }
}

/* Loading state for images */
.product-image {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
}

.product-image:not([src]) {
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Ensure proper card spacing and alignment */
.row.g-4 {
  --bs-gutter-x: 1.5rem;
  --bs-gutter-y: 1.5rem;
}

.col-6, .col-sm-4, .col-md-3, .col-lg-2 {
  padding-right: calc(var(--bs-gutter-x) * 0.5);
  padding-left: calc(var(--bs-gutter-x) * 0.5);
  margin-bottom: var(--bs-gutter-y);
}

.dropdown-menu .dropdown-item.active {
  background: #2d5a27;
  color: white;
  border-radius: 6px;
}
#priceFilterBtn {
  font-size: 0.9rem;
  font-weight: 500;
}
.dropdown-menu input {
  border: 1px solid #ddd;
}
.dropdown-menu input:focus {
  border-color: #2d5a27;
  box-shadow: 0 0 4px rgba(45,90,39,0.3);
}

</style>
